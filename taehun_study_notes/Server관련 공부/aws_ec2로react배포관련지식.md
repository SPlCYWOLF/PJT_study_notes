## aws ec2 로 react (next.js) 배포 기초 지식



# Nginx

<hr>

### What is it?

- HTTP 프로토콜을 사용해서 웹서버의 기능을 하는 서버.
- 웹서버란, 네트워크를 통해서 정적인 파일들을 브라우저로 볼 수 있게 서빙해주는 역할
- 클라이언트가 요청하면 HTML 혹은 이미지, JS 파일 등을 서빙해주는 역할
- DB 서버, 웹 어플 서버, 등 여러가지 종류의 서버가 존재하는데, 그 중 nginx는 웹 서버

# Nginx  로 웹서버 켜기

<hr>

1. Nginx 설치하려 Ubuntu 서버에 먼저 접속하기위해 MobaXterm 실행.

2. MobaXterm 에서 우분투 서버 세션 생성

3. 우분투 서버 세션 클릭해서 우분투 서버 접속

4. `sudo apt-get update` 명령어로 기존에 우분투 서버에 설치되어있는 패키지를 최신화 가능한 목록 조회

5. `sudo apt-get upgrade` 로 가져온 목록들을 업그레이드

6. `sudo apt-get install nginx` 로 nginx 다운로드

7. nginx 우분투 서버에 설치 완료!

8. `ls /var/www/html`

   `` 



<hr>



# Server? EC2?  정리 노트



## Part 1. 서버 길라잡이

### 1) 서버 구축 방식

온프레미스 방식(IDC): 소프트웨어 등 솔루션을 클라우드 같이 원격 환경이 아닌 자체적으로 보유한 전산실 서버에 직접 설치해 운영하는 방식.

클라우드 방식: MS, Amazon과 같이 외부 서비스 공급자가 데이터를 호스트하는 방식. 인터넷을 통해 해당 서비스에 액세스하고 관리할 수 있다.

    1) 두 방식의 장단점

  - 비용 및 유지관리 측면

**온프레미스 방식은** 초기에 인프라 배포를 위해 많은 자본을 투자해야 한다. HW에서 결함이 생기거나 교체해야할 때, 추가적인 자금이 필요하며 신규 비즈니스의 경우 큰 단점이 될 수 있다. 그러나 지속적인 클라우드 서비스 구독 요금이 필요 없으며, **저장된 파일에 액세스하는 데 훨씬 적은 대역폭이 필요해 인터넷 요금 절약**이 가능하다.

**클라우드 방식은** 초기 비용이 적으며, 유지 관리/최신 SW/보안 및 지원을 클라우드 공급자가 담당해 인력이 훨씬 적게 든다. 그러나 액세스에 큰 대역폭이 필요해 인터넷 요금이 조금 더 부과될 수 있다.

이외에도 **보안성, 인터넷 규약, 스케일링 성능, 안정성, 데이터 백업, 디바이스 프리 등** 다양한 장단점을 비교할 수 있으나 클라우드가 여러모로 좋으며, 서비스 규모가 작을 수록 장점이 더욱 부각된다. 따라서 클라우드를 추천.

### 2) CLI를 다룰 수 있는 도구들

cmd, git bash, puTTy과 같은 다양한 도구가 있지만, AWS의 EC2를 사용하기 위해서 **MobaXterm** 라는 CLI 도구를 사용할 예정

### 3) 기본 세팅 로드맵

1) EC2 Ubuntu Server
2) DB 구축
3) 웹서버 설치
4) 프록시 서버 설치
5) 배포: 젠킨스, 도커, npm, gradle 등

### 4) 주의사항!

- SSH 포트(22번) 닫지 않게 조심하기. 닫으면 키를 초기화해야 한다.
- DB 세팅 조심. 생각보다 자주 일어나는 실수 중 하나이다.
- 설정/오류/기타 메모 등 세부적인 사항을 기록해두면 시야를 넓히고 똑같은 실수 반복을 줄일 수 있어서 시간을 오히려 줄일 수 있다.


## Part 2. AWS EC2 사용하기

### 1) 서버 접속하기

 MobaXterm에 받은 개인키/공개키(.pem/.ppk)로 접속하면 서버 내 디렉토리, 파일 등을 GUI식으로 확인할 수 있어서 편한 쉘 접속 프로그램

[Session Settings] 메뉴에 들어가서 SSH 탭 내에 배포받은 .pem 키를 선택하고 접속하면 끝

### 2) MySQL 연결

 구글 선생님과 원만한 대화 후 잘 해결하자

### 3) 배포하기

 mobaXterm에 nginx 기본 설정 후 원하는 FE/BE 파일을 배포해주면 된다.

 리눅스 명령어를 알아두면 좋은데, **vi(파일 편집 명령어), sudo(관리자 권한)** 등이 있다.

 vi로 nginx default 창 내의 기본 디렉토리 등을 적당히 조절해주면 좋다. 해당 명령어는 `sudo vi /etc/nginx/sites-available/default`

 무려 **드래그 앤 드랍**이 돼서 배포 파일을 쉽게 서버에 설치할 수 있다.

1) 대표 명령어 네 가지

```shell
  ps -ef | grep <jar-name>.jar
  # 현재 jar의 PID(프로세스 아이디) 확인
```

```shell
  kill -9 <PID>
  # 해당 프로세스 아이디의 프로세스 종료
```

```shell
  sudo service nginx restart
  # Nginx 재시작
```

```shell
  nohup java -jar <jar-name>.jar &
  # 백그라운드 실행 명령어
```

### 4) DB 공유하기

 Hostname에 서버 이름을 적어두고, **root 계정 외 다른 계정으로 설정 후** DB에 접속하면 된다.
 주의할 점은 **포트 번호 잘 열어뒀는지 확인하기!**

---


## 참고 자료 출처

https://www.microsoft.com/ko-kr/microsoft-365/business-insights-ideas/resources/cloud-storage-vs-on-premises-servers

http://wiki.hash.kr/index.php/%EC%98%A8%ED%94%84%EB%A0%88%EB%AF%B8%EC%8A%A4

